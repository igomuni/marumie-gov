# GitHub開発ワークフロー実践手順

**作成日時**: 2025-11-15 08:14
**タスク**: リリースURLとリポジトリ参照の更新
**ブランチ**: `fix/1-update-repository-references`
**コミット**: ca52ca9

## 完了済み作業

### ✅ コード修正完了

以下のファイルを更新し、コミット・プッシュ済み：

1. **scripts/download-data.js**
   - `RELEASE_URL` を旧リポジトリから新リポジトリに変更
   - 変更前: `https://github.com/igomuni/rs_system_pipeline_marumie/releases/download/v1.0.0/projects_data.tar.gz`
   - 変更後: `https://github.com/igomuni/marumie-gov/releases/download/v1.0.0/projects_data.tar.gz`

2. **package.json**
   - `name` フィールドを `rs_system_pipeline_marumie` から `marumie-gov` に変更

3. **package-lock.json**
   - リポジトリ参照を一括置換（2箇所）

### ✅ データファイル準備完了

- 旧リポジトリから `projects_data.tar.gz` をダウンロード済み
- 保存場所: `./projects_data.tar.gz`
- ファイルサイズ: 5.1MB

---

## 次のステップ（未完了）

### ステップ1: GitHub Issueの作成

**URL**: https://github.com/igomuni/marumie-gov/issues/new?template=task.md

**入力内容**:

#### タイトル
```
[TASK] リリースURLとリポジトリ参照の更新
```

#### 本文
```markdown
## タスクの概要
旧リポジトリ（`rs_system_pipeline_marumie`）への参照を新リポジトリ（`marumie-gov`）に更新する。

## 詳細
- [x] `scripts/download-data.js` のRELEASE_URLを新リポジトリのリリースURLに更新
- [x] `package.json` 内の `rs_system_pipeline_marumie` を `marumie-gov` に更新
- [x] `package-lock.json` 内の `rs_system_pipeline_marumie` を `marumie-gov` に更新
- [ ] 新リポジトリでGitHub Releaseを作成し、データファイル（`projects_data.tar.gz`）をアップロード
- [ ] ビルドテストで動作確認

## 受け入れ基準
- 新リポジトリのリリースからデータダウンロードが正常に動作すること
- package.json と package-lock.json に旧リポジトリ名が残っていないこと
- ビルドが正常に完了すること

## 技術的な考慮事項
- データファイルサイズ: 5.1MB
- ダウンロード元（旧）: https://github.com/igomuni/rs_system_pipeline_marumie/releases/download/v1.0.0/projects_data.tar.gz
- ダウンロード先（新）: https://github.com/igomuni/marumie-gov/releases/download/v1.0.0/projects_data.tar.gz
```

#### ラベル
- `task`
- `priority/high`

**完了後**: Issue番号をメモ（例: #1）

---

### ステップ2: GitHub Releaseの作成

**URL**: https://github.com/igomuni/marumie-gov/releases/new

**入力内容**:

#### Tag
```
v1.0.0
```

#### Release title
```
v1.0.0 - Initial Data Release
```

#### Description
```markdown
## 初回データリリース

行政事業レビューのプロジェクトデータ（前処理済み）

### 📊 含まれるデータ
- 事業別のプロジェクトJSON（12,573事業分）
- 対象年度: 2014年度〜2024年度
- ファイルサイズ: 5.1MB（圧縮後）

### 🚀 使用方法
このリリースのアセットは、ビルド時に自動的にダウンロードされます。

```bash
npm run download-data
```

### 📦 含まれるファイル
- `projects_data.tar.gz` - 前処理済みプロジェクトデータ

### 🔗 関連情報
- 元データ: [行政事業レビュー](https://www.gyoukaku.go.jp/)
- データ処理パイプライン: [RS System Pipeline](https://github.com/igomuni/rs_system_pipeline)
```

#### アセットの添付
1. **Attach binaries** セクションに `./projects_data.tar.gz` をドラッグ&ドロップ
2. アップロード完了を確認

#### 公開
- **Publish release** ボタンをクリック

**確認**: リリースページで `projects_data.tar.gz` がダウンロード可能になっていることを確認

---

### ステップ3: Pull Requestの作成

**URL**: https://github.com/igomuni/marumie-gov/pull/new/fix/1-update-repository-references

**入力内容**（PRテンプレートに従って記入）:

#### 概要
```
旧リポジトリ（rs_system_pipeline_marumie）への参照を新リポジトリ（marumie-gov）に更新
```

#### 関連Issue
```
Closes #1
```
※ステップ1で作成したIssue番号に置き換え

#### 変更内容
- [x] バグ修正
- [x] リファクタリング

#### 変更の詳細
```markdown
- scripts/download-data.jsのRELEASE_URLを新リポジトリのリリースURLに更新
- package.jsonのnameフィールドを `marumie-gov` に変更
- package-lock.json内の旧リポジトリ名を一括置換（2箇所）
```

#### テスト
- [ ] ローカルで動作確認済み（※Releaseアップロード後に実施）
- [ ] デプロイ環境で動作確認済み
- [x] 既存機能への影響がないことを確認

#### チェックリスト
- [x] コードは適切にフォーマットされている
- [x] コミットメッセージは分かりやすい
- [ ] 必要に応じてドキュメントを更新した
- [x] 破壊的変更はない

#### 備考
```
リリース作成後、以下のコマンドでビルドテストを実施してください：

# プロジェクトディレクトリを削除（既存データをクリア）
rm -rf public/data/projects

# データダウンロードとビルドを実行
npm run build
```

**PR作成後**: PR番号をメモ（例: #2）

---

### ステップ4: 動作確認（ローカルテスト）

Releaseが公開された後、以下のコマンドでテストを実施：

```bash
# 1. 既存のプロジェクトデータを削除
rm -rf public/data/projects

# 2. データダウンロードスクリプトを実行
npm run download-data

# 3. 正常にダウンロードされたことを確認
ls -lh public/data/projects/*.json | wc -l
# 期待値: 12573（事業数）

# 4. ビルドテスト
npm run build

# 5. ローカルサーバー起動
npm run dev
```

#### 確認項目
- [ ] データダウンロードが成功すること
- [ ] ビルドエラーが発生しないこと
- [ ] アプリが正常に起動すること
- [ ] サンキー図が表示されること
- [ ] 事業レポートが表示されること

---

### ステップ5: PRのマージ

動作確認が完了したら：

1. PRページでテスト結果をチェックボックスで更新
2. CIが通っていることを確認（GitHub Actions）
3. **Merge pull request** をクリック
4. マージ方法を選択（推奨: **Squash and merge**）
5. コミットメッセージを確認
6. **Confirm squash and merge** をクリック

---

### ステップ6: ブランチのクリーンアップ

マージ後：

```bash
# リモートブランチは自動削除されるため、ローカルブランチのみ削除

# mainブランチに切り替え
git checkout main

# mainブランチを最新化
git pull origin main

# ローカルの作業ブランチを削除
git branch -d fix/1-update-repository-references
```

---

## トラブルシューティング

### データダウンロードが失敗する場合

**エラー例**: `Error downloading file: getaddrinfo ENOTFOUND`

**対処法**:
1. Releaseが正しく公開されているか確認
2. URLが正しいか確認（typoがないか）
3. ネットワーク接続を確認
4. 手動でダウンロードして配置:
   ```bash
   curl -L "https://github.com/igomuni/marumie-gov/releases/download/v1.0.0/projects_data.tar.gz" -o projects_data.tar.gz
   tar -xzf projects_data.tar.gz -C public/data/
   ```

### ビルドエラーが発生する場合

**対処法**:
1. node_modulesを削除して再インストール:
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```
2. Next.jsのキャッシュをクリア:
   ```bash
   rm -rf .next
   ```
3. 再度ビルド:
   ```bash
   npm run build
   ```

---

## 参考リンク

- リポジトリ: https://github.com/igomuni/marumie-gov
- プロジェクトボード（作成予定）: https://github.com/igomuni/marumie-gov/projects
- 貢献ガイド: [.github/CONTRIBUTING.md](../.github/CONTRIBUTING.md)
- CI設定: [.github/workflows/ci.yml](../.github/workflows/ci.yml)

---

## 完了チェックリスト

- [ ] ステップ1: GitHub Issue作成
- [ ] ステップ2: GitHub Release作成
- [ ] ステップ3: Pull Request作成
- [ ] ステップ4: 動作確認（ローカルテスト）
- [ ] ステップ5: PRのマージ
- [ ] ステップ6: ブランチのクリーンアップ

すべて完了したら、このドキュメントを更新してチェックマークを入れてください。
